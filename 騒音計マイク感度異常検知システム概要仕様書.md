# 騒音計マイク感度異常検知概要仕様書
---
## 1.システム概要
騒音計マイク異常検知システム仕様と機能を以下に定義する

### 1.1 ソフトウェア開発環境
* Windows 11 64bit / Windows 10 64bit
* 開発言語 Python
* 北海道道庁の実験機 DL100(富丘 CH53)から実音データを回収して開発する

---
## 2.システム構成

### 2.1 ソフトウェア一覧

#### 2.1.1 異常検知ソフトウェア(soundvalid)
* 中央局環境で定期的に自動実行し、実音データを分析して騒音計の異常有無を検知、通知する機能を持ったソフトウェア

#### 2.2.2 パラメータ分析・調整用ソフトウェア
* 手動で実行し、実音データを分析して異常検知ソフトウェアの分析パラメータの検証を行うためのソフトウェアツール

#### 2.2.3 騒音計信号・サブマイク信号の入力ゲイン調整用ソフトウェア
* サブマイク設置作業時に、騒音計信号・サブマイク信号の感度を一致させるためのリアルタイム入力レベル表示ソフトウェアツール


### 2.2.ハードウェア一覧

#### 2.2.1 オーディオインターフェース
  * TRSもしくはXLRマイク入力端子2つ以上を備える事
  * USBでコンピュータに接続可能
  * オーディオインターフェースはWindowsXP,7,10,11に対応したドライバが用意されている
  * 入力端子のうち、少なくとも1チャンネルは48Vファンタム電源供給可能なもの

#### 2.2.2 サブマイク
  * 200Hz以上3000Hz以下の周波数で測定可能なもの
  * オーディオインターフェースから供給されるファンタム電源で駆動するもの
  * 無指向性マイクロホンであること
  * 屋外で継続して使用可能な防水性能を備えるもの
  * 屋外で継続して使用可能な動作温度を備えるもの

#### 2.2.3 サブマイク取付用治具
  * 指向性などサブマイクの音響性能になるべく影響のない構造
  * サブマイクの設置により騒音レベルに影響を与えない構造

### 2.3 連携する機器、ソフトウェアなど

#### 2.3.1 中央局
* 異常検知ソフトウェアの実行環境

#### 2.3.2 騒音・識別測定局(DL100)
* 別途オーディオインターフェースを接続して騒音計、サブマイクの実音を録音する

#### 2.3.3 社内保守端末(ヘルプコールソフト)
* 異常検知ソフトウェアが検知した異常を受信して通知する

#### 2.3.4 ノートPC
* パラメータ分析・調整用ソフト,騒音計信号・サブマイク信号の入力ゲイン調整用ソフトを実行するためのPC

#### 2.3.5 DLOnlinmeMulti
* 測定局から中央局に録音した実音データを回収するソフトウェア

#### 2.3.6 Horn
* 異常検知ソフトウェアが出力したWindowsイベントをヘルプコールにして社内端末に転送するソフトウェア
---
## 3．機能一覧

#### 3.1 2チャンネル実音データの録音
- 機能の実現手順↓
  * 騒音計マイクロホン信号とサブマイクロホン信号をオーディオインターフェースに入力する
  * 測定局コンピュータにオーディオインターフェースをUSB接続する
  * DL100のプログラム設定、オーディオを接続したオーディオインターフェース、録音チャンネル数を2に変更する
  * 測定・録音の閾値はDL100のプログラム設定に準拠する
  * WAVファイルのチャンネルマッピングはch1がサブマイク、ch2を騒音計とする

#### 3.2 異常検査の実行設定
* 検査する測定局を選択・変更できる
* 1日に1回など期間と時刻でスケジューリングし、自動起動して検査を行う
* 対象日付を指定し、手動で検査を行う。日付は複数指定可
* 測定局ごとに検査する周波数帯域を選択・変更できる

#### 3.3 騒音計の音響校正後に比較用のデータを算出・保存
* 音響校正した時刻を指定して手動で実行する
* データ算出する測定局を選択・変更できる
* データ算出時に用いるパラメータを測定局ごとに選択・変更できる
* 算出したデータをjsonファイル形式で保存する
* 比較用データを再算出する際には既存のデータを自動でバックアップする。バックアップをするしないの変更も可

#### 3.4 異常検知・検査
- 検知する異常の一覧↓
  * ①マイクロホンの結露などによる数dB以上の感度変化
  * ②自己ノイズの上昇などによる騒音レベルの異常
  * ③突発的に発生する継続時間の非常に短いノイズ

- ①，②の手順の概要↓
  * 事前に音響校正直後かつ正常状態の比較データを求めて保存しておく
  * 対象測定局の実音データから異常検知データセットを算出する
  * 異常検知データセットは周波数帯域ごとに算出する
  * 異常検知データセットから統計値を求める
  * 統計値と正常データを比較し、差が閾値よりも大きければ、異常と判定する

* データセット算出時のサンプルサイズの指定方法を以下の中から変更可能↓
  * 検査対象日に録音されたすべての実音データを使用
  * 必要なサンプルサイズを指定し、検査対象日より以前のデータを使用
  * 必要なサンプルサイズを指定し、検査対象日より以前のデータを条件付きで使用

* ③については、検査対象日の実音データを一つずつ検査することで実現する

#### 3.5 異常発生時の通知
* 異常メッセージがあるか確認する
* 異常メッセージの内容を整理して、windowsイベントログを出力する
* 中央局で動作している障害監視ソフトHornがwindowsイベントを検知し、社内の保守端末にヘルプコールを送信する

####  3.6 分析結果の保存
* 検査実行時、異常発生時の分析用に算出したデータを保存する
  * 算出した異常検知データ(csvなど)
  * 異常判定の度数分布等の画像ファイル
* 結果を保存する測定局を選択・変更できる

#### 3.6 実音データ・パラメータ分析表示
* 測定局ごとの実音データを分析し、統計値などをグラフなどで視覚的に表示して異常検知ソフトウェアのパラメータ調整の助けとなる情報を表示する機能

---
### 更新履歴
* 2023/10/13　作成　堤野
* 2023/10/13　ソフトウェア機能に関する基本的な仕様をまとめた 堤野
* 2023/10/16　ハードウェア機能に関する基本的な仕様をまとめた 堤野
* 2024/03/06　機能に関する詳細な仕様をまとめた 堤野