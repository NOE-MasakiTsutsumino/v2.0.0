# 騒音計マイク感度異常検知仕様書

## １．概要

騒音計マイク感度異常検知システムの仕様を以下に定義する

## 2．仕様

### 2.1．ソフトウェア開発環境

* Windows 11 64bit / Windows 10 64bit
* 開発言語 Python
* 北海道道庁の実験機 DL100(富丘 CH53)からデータを回収して開発する

### 2.2.ハードウェア

* オーディオインターフェース
  * TRSもしくはXLRマイク入力端子2つ以上を備えたUSB接続のオーディオインターフェース1台
  * オーディオインターフェースはWindowsXP,7,10,11に対応したドライバが用意されている
  * 入力端子のうち、1チャンネルはサブマイク用の48Vファンタム電源供給可
* サブマイク
  * 小型のファンタム電源駆動するコンデンサマイク
  * 防水仕様
  * 無指向性
  * 動作温度

## 3.システム動作

本システムの処理の流れは以下の通り

### 3.1 実音データの作成・保存

* 処理は測定器(DL)が行う
* 騒音計ACOutとサブマイクロホンの出力はオーディオインターフェースに入力
* DL100は単発録音、2チャンネルのWAVファイルを保存
  * 既定はch1がサブマイク.ch2が騒音計
* 保存場所は実音ファイルの標準の保存先と同じ(標準のフォルダ構成)

### 3.2 正常パラメータ算出・保存

* 処理は中央局にインストールされたソフトウェアが行う
* 正常パラメータ算出・保存処理は必要時に手動で実行する
* 実音ファイルは中央局のDLOnliMultiで回収する

* 処理の流れ
  * 1.対象測定局の指定時刻以降の実音ファイルを指定数読み込む
  * 2.実音ファイルからオクターブバンドごとの正常パラメータ算出
  * 3.正常パラメータをjsonファイルに保存

* 保存する正常パラメータとは80パーセントレンジレベルの上端値、下端値を求めて、そこからさらに以下を求めて保存する
  * 分散
  * 95%信頼区間の上端値、下端値

* 正常パラメータは異常検知の精度に関わるため、人が精査し、確認してから保存できるようにする。
* 〇%パーセントレンジレベルの〇%、〇%信頼区間は必要に応じて変更可能とする。

### 3.3 騒音計の異常診断

マイクの水没、水滴付着等によるノイズ上昇、騒音計ACoutの出力が壊れて実音が録れない、騒音計マイクの故障といった異常検知を行う処理

* 処理は中央局にインストールされたソフトウェアが行う
* 毎日1回、定期的に自動で実行される
* 正常パラメータが保存されていない場合は実行不可

* 処理の流れ
  * 対象測定局の正常パラメータを読み込む
  * 異常検知対象日の実音ファイルを全て読み込む
  * 実音ファイルごとに異常検知パラメータを算出
  * 異常検知パラメータと正常パラメータを比較し、閾値より外れていたらアプリケーションログに内容書き出し

### 3.4 騒音計マイクの感度確認

騒音計マイクの指示値(感度)が定期点検で校正した値より大きく低下・上昇(±0.7dBを想定)していないか判定する処理

* 処理は中央局にインストールされたソフトウェアが行う
* 毎日1回、定期的に自動で実行される
* 正常パラメータが保存されていない場合は実行不可

* 処理の流れ
  * 対象測定局の正常パラメータを読み込む
  * 異常検知開始時刻から過去に遡って実音ファイルを指定数読み込む
  * 実音ファイルから異常検知パラメータ算出
  * 外れデータは除外し、集めた実音ファイルから求めたパラメータの分散が正常パラメータ以下になるまで繰り返し
  * 除外したデータ数が指定数の50%を超えたら異常検知は不可とする
  * 異常検知パラメータ算出に成功したら、正常パラメータと比較し、閾値より外れていたらアプリケーションログに内容書き出し

### 3.5 異常の通知

* 処理は中央局にインストールされたソフトウェアが行う
* 毎日1回、定期的に自動で実行される
* 異常が検知された場合に呼び出されて実行される

* 処理の流れ
  * アプリケーションログに異常メッセージが書かれているか見る。無ければ何もしない。
  * 異常メッセージの内容を整理して、windowsのイベントログファイルに内容を出力する(レベルはWarning以上に設定)。

* 中央局に常駐しているヘルプコール転送ソフトHornが拾って、社内の保守端末でヘルプコールを発報してくれる。

### 3.6 異常分析用の記録保存

* 処理は中央局にインストールされたソフトウェアが行う

* 算出した異常検知パラメータをcsvで、診断判定時の度数分布グラフを画像ファイルとして保存する
* 異常発生時の原因調査に役立てる

### 更新履歴
* 2023/10/13　作成　堤野
* 2023/10/13　ソフトウェア機能に関する基本的な仕様をまとめた 堤野
* 2023/10/16　ハードウェア機能に関する基本的な仕様をまとめた 堤野